{% extends 'base.html' %}

{% block title %}{{ object.title }} - Django Blog{% endblock %}

{% block content %}
<div class="home-container" style="max-width: 900px;">
  <div class="welcome-section" style="text-align: left;">
    <h2 style="margin-bottom: 10px;">{{ object.title }}</h2>
    <p style="color:#888;">By {{ object.author.username }} • {{ object.published_date|date:"M d, Y H:i" }}</p>
    <div style="margin-top: 20px; white-space: pre-wrap; line-height: 1.7;">{{ object.content }}</div>

    <!-- Tags Section -->
    <p style="margin-top: 15px;">
      <strong>Tags:</strong>
      {% for tag in object.tags.all %}
        <a href="{% url 'posts_by_tag' tag.name %}" style="margin-right: 8px; color: #667eea;">{{ tag.name }}</a>
      {% empty %}
        No tags
      {% endfor %}
    </p>

    <div class="cta-buttons" style="margin-top: 25px; justify-content: flex-start;">
      <a href="{% url 'post-list' %}" class="btn btn-secondary">← Back to Posts</a>
      {% if request.user == object.author %}
        <a href="{% url 'post-update' object.pk %}" class="btn btn-primary">Edit</a>
        <a href="{% url 'post-delete' object.pk %}" class="btn btn-secondary">Delete</a>
      {% endif %}
    </div>
  </div>

  <!-- Comments Section -->
  <div class="welcome-section" style="margin-top: 30px;">
    <h3 style="color: #667eea; margin-bottom: 20px;">Comments ({{ comments.count }})</h3>
    
    <!-- Comment Form -->
    {% if user.is_authenticated %}
      <div class="form-container" style="max-width: 100%; margin-bottom: 30px;">
        <h4 style="margin-bottom: 15px;">Add a Comment</h4>
        <form method="post" action="{% url 'comment-create' object.pk %}">
          {% csrf_token %}
          <div class="form-group">
            {{ comment_form.content }}
            {% if comment_form.content.errors %}
              <div class="error-message" style="display: block;">
                {{ comment_form.content.errors.0 }}
              </div>
            {% endif %}
          </div>
          <button type="submit" class="submit-btn">Post Comment</button>
        </form>
      </div>
    {% else %}
      <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
        <p>Please <a href="{% url 'login' %}">login</a> to leave a comment.</p>
      </div>
    {% endif %}

    <!-- Comments List -->
    {% if comments %}
      <div class="feature-grid" style="grid-template-columns: 1fr; gap: 15px;">
        {% for comment in comments %}
          <div class="feature-card" style="text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
              <div>
                <strong style="color: #667eea;">{{ comment.author.username }}</strong>
                <span style="color: #888; font-size: 0.9rem; margin-left: 10px;">
                  {{ comment.created_at|date:"M d, Y H:i" }}
                </span>
              </div>
              {% if request.user == comment.author %}
                <div style="display: flex; gap: 10px;">
                  <a href="{% url 'comment-update' comment.pk %}" style="color: #667eea; text-decoration: none; font-size: 0.9rem;">Edit</a>
                  <a href="{% url 'comment-delete' comment.pk %}" style="color: #e74c3c; text-decoration: none; font-size: 0.9rem;">Delete</a>
                </div>
              {% endif %}
            </div>
            <div style="white-space: pre-wrap; line-height: 1.5;">{{ comment.content }}</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div style="text-align: center; padding: 20px; color: #666;">
        <p>No comments yet. Be the first to comment!</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
